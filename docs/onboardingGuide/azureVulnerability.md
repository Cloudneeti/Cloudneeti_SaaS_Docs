# STEP 7: Configure vulnerability scanning
Configure Azure Security Center for partner vulnerability scanning. This is a prerequisite to get vulnerability assessment data for Virtual Machines in Cloudneeti Azure cloud account.


## 7.1 Collect data from an Azure virtual machine with Azure Monitor

Installing the Log Analytics VM extension for Windows and Linux allows Azure Monitor to collect data from your Azure VMs

1. Navigate to **Log Analytics Workspaces**

2. Create or use existing log analytics workspace

    ![Azure vulnerability](.././images/vulnerability/log_analytics_workspace.png#thumbnail)

3. Select Windows VMs for connecting the Log Analytics workspace

    ![Azure vulnerability](.././images/vulnerability/workspace_vms.png#thumbnail)

4. Click **Connect** to add log analytics workspace

    ![Azure vulnerability](.././images/vulnerability/workspace_vms_connect.png#thumbnail)

5. Enable Auto Provisioning of Azure Security Center monitoring agent.

    ![Azure vulnerability](.././images/vulnerability/ASC_PricingTier.png#thumbnail)
    
    ![Azure vulnerability](.././images/vulnerability/ASC_AutoProvisioningOn.png#thumbnail)

6. Verify extension is added
    
    ![Azure vulnerability](.././images/vulnerability/ExtenstionMonitor.png#thumbnail)

7. Check **Recommendation**, it may take some time.

    ![Azure vulnerability](.././images/vulnerability/MonitorRecommendation.png#thumbnail)


### 7.2 Deploy a partner vulnerability scanning solution in Azure Security center

Follow [link](https://docs.microsoft.com/en-us/azure/security-center/partner-vulnerability-assessment) to deploy vulnerability assessment solutions from Qualys.

![Azure vulnerability](.././images/vulnerability/security_solution.png#thumbnail)


### 7.2 Install Qualys agent 

1. Navigate to **Compute & apps** in **Security Center** 

2. Choose recommendation 

    ![Azure vulnerability](.././images/vulnerability/SelectRecommendation.png#thumbnail)

3. Install solution on selected VMs

    ![Azure vulnerability](.././images/vulnerability/install_solution.png#thumbnail)

4. Verify the extension status Qualys agent should be **Provisioning succeeded**
    
    ![Azure vulnerability](.././images/vulnerability/extension_verification.png#thumbnail)


### 7.3 Verify instance status is healthy

1. Navigate to **Compute & apps**(2) in **Security Center**(1)

2. Select **VMs and Servers** (3)

3. Select VM to be verified (4)

    ![Azure vulnerability](.././images/vulnerability/ASC_Compute.png#thumbnail)

4. Select recommendation **Vulnerability assessment solution should be installed on your virtual machines**

    ![Azure vulnerability](.././images/vulnerability/ASC_Instance_Passed_Healthy.png#thumbnail)

### 7.4 Verify data on Cloudneeti

After successful scan, Azure Windows VM vulnerability assessment will appear on **Vulnerability** tab on **Asset Security** dashboard

![Azure vulnerability](.././images/vulnerability/vulnerabilityTab_Details.png#thumbnail)





    