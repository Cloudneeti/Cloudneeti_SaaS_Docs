<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="description" content="Cloudneeti Documentation"><meta name="author" content="The Cloudneeti Team"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.1.2, mkdocs-material-4.3.1"><title>Onboarding steps - Documentation</title><link rel="stylesheet" href="../../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css"><meta name="theme-color" content=""><script src="../../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,400i,700|&display=swap"><style>body,input{font-family:"Poppins","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../../assets/fonts/material-icons.css"><link rel="stylesheet" href="../../stylesheets/extra.css"><script>window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-149855644-1", "docs.cloudneeti.com")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })</script><script async src="https://www.google-analytics.com/analytics.js"></script></head><body dir="ltr" data-md-color-primary="cloudneeti" data-md-color-accent="cloudneeti"><svg class="md-svg"><defs></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#azure-subscription-onboarding-guide" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="../.." title="Documentation" class="md-header-nav__button md-logo md-custom-logo"><img src="../../images/logo.png" width="170" height="40"></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><!--<span class="md-header-nav__topic"><a href="../..">Documentation</a></span><span class="md-header-nav__topic">Onboarding steps</span>--></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Type to start searching</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="../.." title="Documentation" class="md-nav__button md-logo"><img src="../../images/logo.png" width="48" height="48"></a>Documentation</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1"><label class="md-nav__link" for="nav-1">Introduction</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-1">Introduction</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../gettingStarted/introduction/" title="Getting Started" class="md-nav__link">Getting Started</a></li><li class="md-nav__item"><a href="../../gettingStarted/productFeatures/" title="Product Features" class="md-nav__link">Product Features</a></li><li class="md-nav__item"><a href="../../gettingStarted/howItWorks/" title="How it works" class="md-nav__link">How it works</a></li><li class="md-nav__item"><a href="../../gettingStarted/cloudSecurityBestPractices/" title="Cloud Security Best Practices" class="md-nav__link">Cloud Security Best Practices</a></li><li class="md-nav__item"><a href="../../gettingStarted/deploymentArchitecture/" title="Deployment Architecture" class="md-nav__link">Deployment Architecture</a></li><li class="md-nav__item"><a href="../../gettingStarted/customerDataSecurity/" title="Customer Data Security" class="md-nav__link">Customer Data Security</a></li><li class="md-nav__item"><a href="../../gettingStarted/glossary/" title="Glossary" class="md-nav__link">Glossary</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2"><label class="md-nav__link" for="nav-2">Try and Buy</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">Try and Buy</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../tryAndBuy/freeTrial/" title="Free Trial" class="md-nav__link">Free Trial</a></li><li class="md-nav__item"><a href="../../tryAndBuy/subscribeOnAzureMarketplace/" title="Buy on Azure Marketplace" class="md-nav__link">Buy on Azure Marketplace</a></li><li class="md-nav__item"><a href="../../tryAndBuy/subscribe/" title="Request a License" class="md-nav__link">Request a License</a></li><li class="md-nav__item"><a href="../../tryAndBuy/partnerCobranding/" title="Partner co-branding" class="md-nav__link">Partner co-branding</a></li><li class="md-nav__item"><a href="../../tryAndBuy/estimatePricing/" title="Estimate Pricing" class="md-nav__link">Estimate Pricing</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3"><label class="md-nav__link" for="nav-3">Security Policies</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-3">Security Policies</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../gettingStarted/cloudSecurityBestPractices/" title="Cloud Security Best Practices" class="md-nav__link">Cloud Security Best Practices</a></li><li class="md-nav__item"><a href="../../securityPolicies/awsSecurityPolcies/" title="AWS Security Policies" class="md-nav__link">AWS Security Policies</a></li><li class="md-nav__item"><a href="../../securityPolicies/azureSecurityPolcies/" title="Azure Security Policies" class="md-nav__link">Azure Security Policies</a></li><li class="md-nav__item"><a href="../../securityPolicies/gcp_SecurityPolcies/" title="GCP Security Policies(Preview)" class="md-nav__link">GCP Security Policies(Preview)</a></li><li class="md-nav__item"><a href="../../securityPolicies/office365SecurityPolcies/" title="Office 365 Security Policies" class="md-nav__link">Office 365 Security Policies</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6"><label class="md-nav__link" for="nav-3-6">OS baselines</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-6">OS baselines</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../securityPolicies/osBaseline/centOSSecurityPolcies/" title="CentOS" class="md-nav__link">CentOS</a></li><li class="md-nav__item"><a href="../../securityPolicies/osBaseline/rhelSecurityPolcies/" title="RHEL" class="md-nav__link">RHEL</a></li><li class="md-nav__item"><a href="../../securityPolicies/osBaseline/ubuntuSecurityPolcies/" title="Ubuntu 18.04" class="md-nav__link">Ubuntu 18.04</a></li><li class="md-nav__item"><a href="../../securityPolicies/osBaseline/windows12SecurityPolcies/" title="Windows 2012 R2" class="md-nav__link">Windows 2012 R2</a></li><li class="md-nav__item"><a href="../../securityPolicies/osBaseline/windows16SecurityPolcies/" title="Windows 2016" class="md-nav__link">Windows 2016</a></li><li class="md-nav__item"><a href="../../securityPolicies/osBaseline/windows19SecurityPolcies/" title="Windows 2019" class="md-nav__link">Windows 2019</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7"><label class="md-nav__link" for="nav-3-7">Kubernetes</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-7">Kubernetes</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../securityPolicies/kubernetes/awsK8SSecurityPolcies/" title="AWS" class="md-nav__link">AWS</a></li><li class="md-nav__item"><a href="../../securityPolicies/kubernetes/azureK8SSecurityPolcies/" title="Azure" class="md-nav__link">Azure</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4"><label class="md-nav__link" for="nav-4">Compliance Benchmarks</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-4">Compliance Benchmarks</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../complianceBenchmarks/complianceBenchmarks/" title="Benchmarks" class="md-nav__link">Benchmarks</a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked><label class="md-nav__link" for="nav-5">Onboarding Guide</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-5">Onboarding Guide</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../onboardingGuideOverview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2"><label class="md-nav__link" for="nav-5-2">Amazon Web Services</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-5-2">Amazon Web Services</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../amazonWebServiceAccounts/" title="Onboarding steps" class="md-nav__link">Onboarding steps</a></li><li class="md-nav__item"><a href="../awsEnableConfigBasedDataCollection/" title="Enable AWS Config Based Data Collection (optional)" class="md-nav__link">Enable AWS Config Based Data Collection (optional)</a></li><li class="md-nav__item"><a href="../awsVMBaselineConfiguration/" title="OS baseline (optional)" class="md-nav__link">OS baseline (optional)</a></li><li class="md-nav__item"><a href="../awsVulnerabilities/" title="Vulnerability (optional)" class="md-nav__link">Vulnerability (optional)</a></li><li class="md-nav__item"><a href="../configureCloudneetiAgentInEKS/" title="Amazon Elastic Kubernetes Service (Amazon EKS) (optional)" class="md-nav__link">Amazon Elastic Kubernetes Service (Amazon EKS) (optional)</a></li><li class="md-nav__item"><a href="../awsAccountHealthStatus/" title="AWS onboarding health status" class="md-nav__link">AWS onboarding health status</a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3" checked><label class="md-nav__link" for="nav-5-3">Microsoft Azure</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-5-3">Microsoft Azure</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">Onboarding steps</label><a href="./" title="Onboarding steps" class="md-nav__link md-nav__link--active">Onboarding steps</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">In this article</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#onboarding-steps" title="Onboarding Steps" class="md-nav__link">Onboarding Steps</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#required-roles" title="Required Roles" class="md-nav__link">Required Roles</a></li><li class="md-nav__item"><a href="#required-permissions" title="Required Permissions" class="md-nav__link">Required Permissions</a></li></ul></nav></li><li class="md-nav__item"><a href="#step-1-create-new-azure-app-registration-manually-or-using-azure-powershell-script" title="STEP 1: Create new Azure App Registration Manually or using Azure powershell script" class="md-nav__link">STEP 1: Create new Azure App Registration Manually or using Azure powershell script</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#11-manual-steps" title="1.1 Manual Steps" class="md-nav__link">1.1 Manual Steps</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#create-new-azure-app-registration" title="Create new Azure App Registration" class="md-nav__link">Create new Azure App Registration</a></li><li class="md-nav__item"><a href="#add-client-secret" title="Add Client Secret" class="md-nav__link">Add Client Secret</a></li><li class="md-nav__item"><a href="#grant-admin-consent-for-api-permissions" title="Grant admin consent for API permissions" class="md-nav__link">Grant admin consent for API permissions</a></li></ul></nav></li><li class="md-nav__item"><a href="#11-automated-steps" title="1.1 Automated Steps" class="md-nav__link">1.1 Automated Steps</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#create-new-azure-app-registration_1" title="Create new Azure App Registration" class="md-nav__link">Create new Azure App Registration</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#prerequisites" title="Prerequisites" class="md-nav__link">Prerequisites</a></li><li class="md-nav__item"><a href="#register-cloudneeti-application" title="Register Cloudneeti Application" class="md-nav__link">Register Cloudneeti Application</a></li><li class="md-nav__item"><a href="#grant-admin-consent-for-api-permissions_1" title="Grant admin consent for API permissions" class="md-nav__link">Grant admin consent for API permissions</a></li></ul></nav></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#step-2-grant-access-to-cloudneeti-registered-app-existing" title="STEP 2: Grant access to Cloudneeti registered app existing" class="md-nav__link">STEP 2: Grant access to Cloudneeti registered app existing</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#21-grant-azure-subscription-reader-role" title="2.1 Grant Azure Subscription Reader role" class="md-nav__link">2.1 Grant Azure Subscription Reader role</a></li><li class="md-nav__item"><a href="#23-collect-information" title="2.3 Collect information" class="md-nav__link">2.3 Collect information</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#azure-directory-id-and-domain-name" title="Azure Directory Id and Domain Name" class="md-nav__link">Azure Directory Id and Domain Name</a></li><li class="md-nav__item"><a href="#registered-cloudneeti-application-id" title="Registered Cloudneeti Application ID" class="md-nav__link">Registered Cloudneeti Application ID</a></li><li class="md-nav__item"><a href="#registered-cloudneeti-application-secret" title="Registered Cloudneeti Application Secret" class="md-nav__link">Registered Cloudneeti Application Secret</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#step-3-grant-access-to-azure-subscription-additional-roles" title="STEP 3: Grant access to Azure subscription additional roles" class="md-nav__link">STEP 3: Grant access to Azure subscription additional roles</a></li><li class="md-nav__item"><a href="#step-4-grant-access-to-key-vaults" title="STEP 4: Grant access to key vaults" class="md-nav__link">STEP 4: Grant access to key vaults</a></li><li class="md-nav__item"><a href="#step-5-advanced-security-configurations" title="STEP 5: Advanced Security configurations" class="md-nav__link">STEP 5: Advanced Security configurations</a></li><li class="md-nav__item"><a href="#step-6-enable-azure-security-center-audit-policies" title="STEP 6: Enable Azure Security Center audit policies" class="md-nav__link">STEP 6: Enable Azure Security Center audit policies</a></li><li class="md-nav__item"><a href="#step-7-configure-os-baseline-and-vulnerability-assessment-solution" title="STEP 7: Configure OS baseline and Vulnerability Assessment Solution" class="md-nav__link">STEP 7: Configure OS baseline and Vulnerability Assessment Solution</a></li><li class="md-nav__item"><a href="#step-8-configure-cloudneeti-agent-on-aks-aks-engine-and-vm-based-kubernetes-clusters" title="STEP 8: Configure Cloudneeti agent on AKS, AKS Engine and VM based Kubernetes Clusters" class="md-nav__link">STEP 8: Configure Cloudneeti agent on AKS, AKS Engine and VM based Kubernetes Clusters</a></li><li class="md-nav__item"><a href="#step-9-add-azure-subscription" title="STEP 9: Add Azure Subscription" class="md-nav__link">STEP 9: Add Azure Subscription</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#91-activate-the-license" title="9.1 Activate the License" class="md-nav__link">9.1 Activate the License</a></li><li class="md-nav__item"><a href="#92-add-cloud-account" title="9.2 Add Cloud Account" class="md-nav__link">9.2 Add Cloud Account</a></li><li class="md-nav__item"><a href="#93-data-collection-and-verfication" title="9.3 Data Collection and verfication" class="md-nav__link">9.3 Data Collection and verfication</a></li></ul></nav></li><li class="md-nav__item"><a href="#next-steps" title="Next Steps" class="md-nav__link">Next Steps</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#onboard-another-microsoft-azure-subscription-to-the-cloudneeti-application" title="Onboard another Microsoft Azure Subscription to the Cloudneeti application" class="md-nav__link">Onboard another Microsoft Azure Subscription to the Cloudneeti application</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#1-azure-subscription-is-in-same-azure-active-directory-as-of-already-added-cloud-accounts" title="1. Azure subscription is in same Azure Active Directory as of already added Cloud accounts." class="md-nav__link">1. Azure subscription is in same Azure Active Directory as of already added Cloud accounts.</a></li><li class="md-nav__item"><a href="#2-azure-subscription-is-in-different-azure-active-directory-as-of-already-added-cloud-accounts" title="2. Azure subscription is in different Azure Active Directory as of already added Cloud accounts." class="md-nav__link">2. Azure subscription is in different Azure Active Directory as of already added Cloud accounts.</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#security-polices-with-required-roles-permissions" title="Security Polices with required roles, permissions" class="md-nav__link">Security Polices with required roles, permissions</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#microsoft-graph" title="Microsoft Graph" class="md-nav__link">Microsoft Graph</a></li></ul></nav></li><li class="md-nav__item"><a href="#offboarding" title="OFFBOARDING" class="md-nav__link">OFFBOARDING</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#delete-app-registration-for-each-azure-subscription" title="Delete App Registration for each Azure Subscription" class="md-nav__link">Delete App Registration for each Azure Subscription</a></li><li class="md-nav__item"><a href="#delete-cloud-account-in-cloudneeti-application" title="Delete cloud account in Cloudneeti application" class="md-nav__link">Delete cloud account in Cloudneeti application</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="../grantAccessToAzureSubscriptionAdditionalRoles/" title="Additional roles" class="md-nav__link">Additional roles</a></li><li class="md-nav__item"><a href="../grantAccessToKeyVaults/" title="Key vaults" class="md-nav__link">Key vaults</a></li><li class="md-nav__item"><a href="../azureAdvancedSecurityConfigurations/" title="Advanced security configurations" class="md-nav__link">Advanced security configurations</a></li><li class="md-nav__item"><a href="../enableASCAuditPolicies/" title="Enable ASC audit policies" class="md-nav__link">Enable ASC audit policies</a></li><li class="md-nav__item"><a href="../azureOSBaseline/" title="OS baseline and vulnerability" class="md-nav__link">OS baseline and vulnerability</a></li><li class="md-nav__item"><a href="../azureVulnerability/" title="Vulnerability" class="md-nav__link">Vulnerability</a></li><li class="md-nav__item"><a href="../configureCloudneetiAgentInAKS/" title="Azure Kubernetes Service (AKS)" class="md-nav__link">Azure Kubernetes Service (AKS)</a></li><li class="md-nav__item"><a href="../azureAccountHealthStatus/" title="Azure onboarding health status" class="md-nav__link">Azure onboarding health status</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4"><label class="md-nav__link" for="nav-5-4">Google Cloud Platform (Preview)</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-5-4">Google Cloud Platform (Preview)</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../gcpOnboardingOverview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../gcpProject/" title="GCP Project" class="md-nav__link">GCP Project</a></li><li class="md-nav__item"><a href="../gcpOrganization/" title="GCP Organization" class="md-nav__link">GCP Organization</a></li><li class="md-nav__item"><a href="../gcpAnnexure/" title="Annexure" class="md-nav__link">Annexure</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5"><label class="md-nav__link" for="nav-5-5">Office 365</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-5-5">Office 365</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../office365Subscription/" title="Onboarding steps" class="md-nav__link">Onboarding steps</a></li><li class="md-nav__item"><a href="../office365AccountHealthStatus/" title="Office 365 onboarding health status" class="md-nav__link">Office 365 onboarding health status</a></li><li class="md-nav__item"><a href="../office365AdvanceSecurityConfigurationUpgrade/" title="Upgrade advanced security configurations" class="md-nav__link">Upgrade advanced security configurations</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6"><label class="md-nav__link" for="nav-6">User Guide</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-6">User Guide</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../gettingStarted/signInAndSignOut/" title="Sign In and Sign Out" class="md-nav__link">Sign In and Sign Out</a></li><li class="md-nav__item"><a href="../../userGuide/userInterface/" title="User Interface" class="md-nav__link">User Interface</a></li><li class="md-nav__item"><a href="../../userGuide/dashboards/" title="Dashboards" class="md-nav__link">Dashboards</a></li><li class="md-nav__item"><a href="../../userGuide/securityPolicies/" title="Security Policies" class="md-nav__link">Security Policies</a></li><li class="md-nav__item"><a href="../../userGuide/complianceBenchmarks/" title="Compliance Benchmarks" class="md-nav__link">Compliance Benchmarks</a></li><li class="md-nav__item"><a href="../../userGuide/reports/" title="Reports" class="md-nav__link">Reports</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7"><label class="md-nav__link" for="nav-7">REST APIs</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-7">REST APIs</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../userGuide/restAPIs/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../../userGuide/apiUserScenarios/" title="API User Scenarios" class="md-nav__link">API User Scenarios</a></li><li class="md-nav__item"><a href="../../userGuide/tokenAPI/" title="Token API" class="md-nav__link">Token API</a></li><li class="md-nav__item"><a href="../../userGuide/getLicenseAccounts/" title="License Accounts API" class="md-nav__link">License Accounts API</a></li><li class="md-nav__item"><a href="../../userGuide/onboardCloudAccount/" title="Onboard cloud account API" class="md-nav__link">Onboard cloud account API</a></li><li class="md-nav__item"><a href="../../userGuide/updateAPIAppAccessScope/" title="Update API app access scope API" class="md-nav__link">Update API app access scope API</a></li><li class="md-nav__item"><a href="../../userGuide/getHealthStatus/" title="Onboarding health status API" class="md-nav__link">Onboarding health status API</a></li><li class="md-nav__item"><a href="../../userGuide/getBenchmarkSummary/" title="Audit summary report API" class="md-nav__link">Audit summary report API</a></li><li class="md-nav__item"><a href="../../userGuide/initiateScanAPI/" title="Initiate scan API" class="md-nav__link">Initiate scan API</a></li><li class="md-nav__item"><a href="../../userGuide/scanStatusAPI/" title="Scan status API" class="md-nav__link">Scan status API</a></li><li class="md-nav__item"><a href="../../userGuide/getSupportedBenchmarks/" title="Get supported benchmarks API" class="md-nav__link">Get supported benchmarks API</a></li><li class="md-nav__item"><a href="../../userGuide/auditReportAPI/" title="Audit report API" class="md-nav__link">Audit report API</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8"><label class="md-nav__link" for="nav-8">Administrator Guide</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-8">Administrator Guide</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../administratorGuide/featuresAndQuotas/" title="Features and Quotas" class="md-nav__link">Features and Quotas</a></li><li class="md-nav__item"><a href="../../administratorGuide/manageLicenses/" title="Integrations" class="md-nav__link">Integrations</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-3" type="checkbox" id="nav-8-3"><label class="md-nav__link" for="nav-8-3">Incident management</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-8-3">Incident management</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../administratorGuide/serviceNowIntegration/" title="Service Now" class="md-nav__link">Service Now</a></li><li class="md-nav__item"><a href="../../administratorGuide/zendeskIntegration/" title="Zendesk" class="md-nav__link">Zendesk</a></li></ul></nav></li><li class="md-nav__item"><a href="../../administratorGuide/azureASCPushIntegration/" title="ASC Push Integration" class="md-nav__link">ASC Push Integration</a></li><li class="md-nav__item"><a href="../../administratorGuide/manageAccounts/" title="Cloud Accounts" class="md-nav__link">Cloud Accounts</a></li><li class="md-nav__item"><a href="../../administratorGuide/manageUsers/" title="Users & Roles" class="md-nav__link">Users & Roles</a></li><li class="md-nav__item"><a href="../../administratorGuide/privateBenchmark/" title="Private Benchmark" class="md-nav__link">Private Benchmark</a></li><li class="md-nav__item"><a href="../../administratorGuide/securityPolicyExclusions/" title="Security Policy Configuration" class="md-nav__link">Security Policy Configuration</a></li><li class="md-nav__item"><a href="../../administratorGuide/overrideSecurityPolicyStatus/" title="Override Security Policy Status" class="md-nav__link">Override Security Policy Status</a></li><li class="md-nav__item"><a href="../../administratorGuide/auditLog/" title="Audit Log" class="md-nav__link">Audit Log</a></li><li class="md-nav__item"><a href="../../administratorGuide/configureCloudneetiAPIAccess/" title="Configure Cloudneeti API Access" class="md-nav__link">Configure Cloudneeti API Access</a></li><li class="md-nav__item"><a href="../../administratorGuide/utilizationDashboard/" title="Utilization Dashboard" class="md-nav__link">Utilization Dashboard</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9"><label class="md-nav__link" for="nav-9">Remediation</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-9">Remediation</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../remediation/overview/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-2" type="checkbox" id="nav-9-2"><label class="md-nav__link" for="nav-9-2">Azure</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-9-2">Azure</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../remediation/azureGuidedRemediation/" title="Guided Remediation" class="md-nav__link">Guided Remediation</a></li><li class="md-nav__item"><a href="../../remediation/azureAutoRemediation/" title="Auto Remediation" class="md-nav__link">Auto Remediation</a></li><li class="md-nav__item"><a href="../../remediation/azureDecommissionofRemediation/" title="Decommission of remediation" class="md-nav__link">Decommission of remediation</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-3" type="checkbox" id="nav-9-3"><label class="md-nav__link" for="nav-9-3">AWS</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-9-3">AWS</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../remediation/awsGuidedRemediation/" title="Guided Remediation" class="md-nav__link">Guided Remediation</a></li><li class="md-nav__item"><a href="../../remediation/awsRemediation/" title="Auto Remediation" class="md-nav__link">Auto Remediation</a></li><li class="md-nav__item"><a href="../../remediation/awsDecommissionofRemediation/" title="Decommission Remediation Framework" class="md-nav__link">Decommission Remediation Framework</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10"><label class="md-nav__link" for="nav-10">Quick wins and OS baseline hardening scripts</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-10">Quick wins and OS baseline hardening scripts</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../remediation/overviewQuickWins/" title="Overview" class="md-nav__link">Overview</a></li><li class="md-nav__item"><a href="../../remediation/awsQuickWins/" title="AWS Quick wins" class="md-nav__link">AWS Quick wins</a></li><li class="md-nav__item"><a href="../../remediation/azureQuickWins/" title="Azure Quick Wins" class="md-nav__link">Azure Quick Wins</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-10-4" type="checkbox" id="nav-10-4"><label class="md-nav__link" for="nav-10-4">OS Hardening for Baseline Configuration</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-10-4">OS Hardening for Baseline Configuration</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../remediation/osBaseline/centOSQuickWins/" title="CentOS Linux 7" class="md-nav__link">CentOS Linux 7</a></li><li class="md-nav__item"><a href="../../remediation/osBaseline/rhelQuickWins/" title="RHEL Linux 7" class="md-nav__link">RHEL Linux 7</a></li><li class="md-nav__item"><a href="../../remediation/osBaseline/win12QuickWins/" title="Windows Server 2012 R2" class="md-nav__link">Windows Server 2012 R2</a></li><li class="md-nav__item"><a href="../../remediation/osBaseline/win16QuickWins/" title="Windows Server 2016" class="md-nav__link">Windows Server 2016</a></li><li class="md-nav__item"><a href="../../remediation/osBaseline/win19QuickWins/" title="Windows Server 2019" class="md-nav__link">Windows Server 2019</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11"><label class="md-nav__link" for="nav-11">Release Notes</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-11">Release Notes</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../releaseNotes/2020/" title="Releases in 2020" class="md-nav__link">Releases in 2020</a></li><li class="md-nav__item"><a href="../../releaseNotes/2019/" title="Releases in 2019" class="md-nav__link">Releases in 2019</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">In this article</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#onboarding-steps" title="Onboarding Steps" class="md-nav__link">Onboarding Steps</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#required-roles" title="Required Roles" class="md-nav__link">Required Roles</a></li><li class="md-nav__item"><a href="#required-permissions" title="Required Permissions" class="md-nav__link">Required Permissions</a></li></ul></nav></li><li class="md-nav__item"><a href="#step-1-create-new-azure-app-registration-manually-or-using-azure-powershell-script" title="STEP 1: Create new Azure App Registration Manually or using Azure powershell script" class="md-nav__link">STEP 1: Create new Azure App Registration Manually or using Azure powershell script</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#11-manual-steps" title="1.1 Manual Steps" class="md-nav__link">1.1 Manual Steps</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#create-new-azure-app-registration" title="Create new Azure App Registration" class="md-nav__link">Create new Azure App Registration</a></li><li class="md-nav__item"><a href="#add-client-secret" title="Add Client Secret" class="md-nav__link">Add Client Secret</a></li><li class="md-nav__item"><a href="#grant-admin-consent-for-api-permissions" title="Grant admin consent for API permissions" class="md-nav__link">Grant admin consent for API permissions</a></li></ul></nav></li><li class="md-nav__item"><a href="#11-automated-steps" title="1.1 Automated Steps" class="md-nav__link">1.1 Automated Steps</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#create-new-azure-app-registration_1" title="Create new Azure App Registration" class="md-nav__link">Create new Azure App Registration</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#prerequisites" title="Prerequisites" class="md-nav__link">Prerequisites</a></li><li class="md-nav__item"><a href="#register-cloudneeti-application" title="Register Cloudneeti Application" class="md-nav__link">Register Cloudneeti Application</a></li><li class="md-nav__item"><a href="#grant-admin-consent-for-api-permissions_1" title="Grant admin consent for API permissions" class="md-nav__link">Grant admin consent for API permissions</a></li></ul></nav></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#step-2-grant-access-to-cloudneeti-registered-app-existing" title="STEP 2: Grant access to Cloudneeti registered app existing" class="md-nav__link">STEP 2: Grant access to Cloudneeti registered app existing</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#21-grant-azure-subscription-reader-role" title="2.1 Grant Azure Subscription Reader role" class="md-nav__link">2.1 Grant Azure Subscription Reader role</a></li><li class="md-nav__item"><a href="#23-collect-information" title="2.3 Collect information" class="md-nav__link">2.3 Collect information</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#azure-directory-id-and-domain-name" title="Azure Directory Id and Domain Name" class="md-nav__link">Azure Directory Id and Domain Name</a></li><li class="md-nav__item"><a href="#registered-cloudneeti-application-id" title="Registered Cloudneeti Application ID" class="md-nav__link">Registered Cloudneeti Application ID</a></li><li class="md-nav__item"><a href="#registered-cloudneeti-application-secret" title="Registered Cloudneeti Application Secret" class="md-nav__link">Registered Cloudneeti Application Secret</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#step-3-grant-access-to-azure-subscription-additional-roles" title="STEP 3: Grant access to Azure subscription additional roles" class="md-nav__link">STEP 3: Grant access to Azure subscription additional roles</a></li><li class="md-nav__item"><a href="#step-4-grant-access-to-key-vaults" title="STEP 4: Grant access to key vaults" class="md-nav__link">STEP 4: Grant access to key vaults</a></li><li class="md-nav__item"><a href="#step-5-advanced-security-configurations" title="STEP 5: Advanced Security configurations" class="md-nav__link">STEP 5: Advanced Security configurations</a></li><li class="md-nav__item"><a href="#step-6-enable-azure-security-center-audit-policies" title="STEP 6: Enable Azure Security Center audit policies" class="md-nav__link">STEP 6: Enable Azure Security Center audit policies</a></li><li class="md-nav__item"><a href="#step-7-configure-os-baseline-and-vulnerability-assessment-solution" title="STEP 7: Configure OS baseline and Vulnerability Assessment Solution" class="md-nav__link">STEP 7: Configure OS baseline and Vulnerability Assessment Solution</a></li><li class="md-nav__item"><a href="#step-8-configure-cloudneeti-agent-on-aks-aks-engine-and-vm-based-kubernetes-clusters" title="STEP 8: Configure Cloudneeti agent on AKS, AKS Engine and VM based Kubernetes Clusters" class="md-nav__link">STEP 8: Configure Cloudneeti agent on AKS, AKS Engine and VM based Kubernetes Clusters</a></li><li class="md-nav__item"><a href="#step-9-add-azure-subscription" title="STEP 9: Add Azure Subscription" class="md-nav__link">STEP 9: Add Azure Subscription</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#91-activate-the-license" title="9.1 Activate the License" class="md-nav__link">9.1 Activate the License</a></li><li class="md-nav__item"><a href="#92-add-cloud-account" title="9.2 Add Cloud Account" class="md-nav__link">9.2 Add Cloud Account</a></li><li class="md-nav__item"><a href="#93-data-collection-and-verfication" title="9.3 Data Collection and verfication" class="md-nav__link">9.3 Data Collection and verfication</a></li></ul></nav></li><li class="md-nav__item"><a href="#next-steps" title="Next Steps" class="md-nav__link">Next Steps</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#onboard-another-microsoft-azure-subscription-to-the-cloudneeti-application" title="Onboard another Microsoft Azure Subscription to the Cloudneeti application" class="md-nav__link">Onboard another Microsoft Azure Subscription to the Cloudneeti application</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#1-azure-subscription-is-in-same-azure-active-directory-as-of-already-added-cloud-accounts" title="1. Azure subscription is in same Azure Active Directory as of already added Cloud accounts." class="md-nav__link">1. Azure subscription is in same Azure Active Directory as of already added Cloud accounts.</a></li><li class="md-nav__item"><a href="#2-azure-subscription-is-in-different-azure-active-directory-as-of-already-added-cloud-accounts" title="2. Azure subscription is in different Azure Active Directory as of already added Cloud accounts." class="md-nav__link">2. Azure subscription is in different Azure Active Directory as of already added Cloud accounts.</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#security-polices-with-required-roles-permissions" title="Security Polices with required roles, permissions" class="md-nav__link">Security Polices with required roles, permissions</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#microsoft-graph" title="Microsoft Graph" class="md-nav__link">Microsoft Graph</a></li></ul></nav></li><li class="md-nav__item"><a href="#offboarding" title="OFFBOARDING" class="md-nav__link">OFFBOARDING</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#delete-app-registration-for-each-azure-subscription" title="Delete App Registration for each Azure Subscription" class="md-nav__link">Delete App Registration for each Azure Subscription</a></li><li class="md-nav__item"><a href="#delete-cloud-account-in-cloudneeti-application" title="Delete cloud account in Cloudneeti application" class="md-nav__link">Delete cloud account in Cloudneeti application</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1 id="azure-subscription-onboarding-guide">Azure Subscription Onboarding Guide</h1>
<h2 id="onboarding-steps">Onboarding Steps</h2>
<p>The following steps are required to onboard Microsoft Azure to the Cloudneeti application.</p>
<p><img alt="Onboarding Steps" src="../../images/azureSubscriptions/Onboarding_Steps.png#thumbnail_1" /></p>
<ol>
<li>
<p><a href=".././onboardingGuide/azureSubscriptions/#create-new-azure-app-registration_1" target="_blank"><strong>Registering the Cloudneeti application</strong></a> includes registering the
    Cloudneeti application with Azure tenant, providing access to Microsoft
    Graph and granting admin consent to the Cloudneeti application.</p>
</li>
<li>
<p><a href=".././azureSubscriptions/#step-2-grant-access-to-cloudneeti-registered-app-existing" target="_blank"><strong>Granting access to the Azure subscription</strong></a> includes giving the Cloudneeti
    application reader access to the Azure subscription and collecting Subscription ID, Directory ID, Domain Name information.</p>
</li>
<li>
<p><a href="../../onboardingGuide/grantAccessToAzureSubscriptionAdditionalRoles/" target="_blank"><strong>Grant access to Azure subscription additional roles (Optional)</strong></a> includes giving the Cloudneeti
    application access to the Azure subscription, assigning <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/custom-roles">Azure custom role.</a> </p>
<ul>
<li>
<p>Custom role with permission <strong>"Microsoft.Web/sites/config/list/action"</strong> for Azure Subscription level scope.
The Cloudneeti application needs "Microsoft.Web/sites/config/list/action" action present in <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#custom-role-with-permission-microsoftwebsitesconfiglistaction">Website Contributor role</a> in order to collect authentication and authorization configuration of Web/API/Mobile/Function Apps which is hosted on the App Service Plan. The current subscription Reader role given doesn't have sufficient permissions to collect web site configuration details.</p>
</li>
<li>
<p>Custom role with permission <strong>"Microsoft.Storage/storageAccounts/listkeys/action"</strong> for Azure Subscription level scope.
Cloudneeti needs "Microsoft.Storage/storageAccounts/listkeys/action" action present in <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#storage">Storage Account Contributor role</a> in order to collect metadata configuration of blobs.  The current subscription <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#reader">Reader role</a> given doesn't have sufficient permissions to list blob keys. </p>
</li>
</ul>
</li>
<li>
<p><a href="../../onboardingGuide/grantAccessToKeyVaults/" target="_blank"><strong>Grant access to key vaults (Optional)</strong></a> includes giving the Cloudneeti application special permission on desired key vaults to get policy data related to secrets.</p>
</li>
<li>
<p><a href="../../onboardingGuide/azureAdvancedSecurityConfigurations/" target="_blank"><strong>Advanced Security configurations (Optional)</strong></a> includes adding a script to the customer’s Azure account and granting the required access rights.</p>
<p>Advanced security configurations (step 5) requires a Cloudneeti PowerShell agent to be installed in an Azure subscription under the same tenant where the Azure subscription is located. The Cloudneeti PowerShell agent retrieves (A) additional configuration information from the Azure Active Directory  (there are no Azure APIs to retrieve this information) and pushes (B) this information as a JSON file to the Cloudneeti application.</p>
</li>
<li>
<p><a href="../../onboardingGuide/azureSubscriptions/#step-6-enable-azure-security-center-audit-policies" target="_blank"><strong>Enable Azure Security Center audit policies (Optional)</strong></a> includes enabling Azure Security Center audit policies (Optional) includes configuring  Azure Security Center free tier in order for Zscaler CSPM to pull all security recommendations and make it available within the product.</p>
<ul>
<li>Note : Please note that it is not required to have Azure Defender enabled (ASC Standard tier).</li>
</ul>
</li>
<li>
<p><a href="../../onboardingGuide/azureVulnerability/" target="_blank"><strong>Configure OS baseline and Vulnerability Assessment Solution (Optional)</strong></a> inlcudes connecting VMs to OMS workspace. Also deploy partner Vulnerability Assessment Solution in Azure Security Center and installing the solution on multiple VMs allows to provide visibility into missing updates, misconfigured OS security settings, endpoint protection status, and health and threat protection.</p>
</li>
<li>
<p><a href="../../onboardingGuide/configureCloudneetiAgentInAKS/" target="_blank"><strong>Configure Cloudneeti agent on AKS, AKS Engine and VM Based Kubernetes Clusters (Optional)</strong></a> inlcudes Deploying Cloudneeti agent on Azure Kubernetes Service enables compliance monitoring of Azure Kubernetes Clusters - AKS, AKS-Engine and VM hosted Kubernetes Clusters.
An Azure docker agent is deployed to collect data for additional security policies.</p>
</li>
<li>
<p><a href=".././azureSubscriptions/#step-9-add-azure-subscription" target="_blank"><strong>Adding Azure subscription</strong></a> includes adding Azure subscription information to the respective Cloud Account and waiting until the first data collection is complete.</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>S. No.</th>
<th>Step</th>
<th>Portal to use</th>
<th>Role</th>
<th>Type</th>
<th>Policies</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a href=".././azureSubscriptions/#step-1-create-new-azure-app-registration-manually-or-using-azure-powershell-script" target="_blank">Create new Azure App Registration </a></td>
<td>Microsoft Azure</td>
<td>Global AD Administrator</td>
<td>mandatory</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td><a href=".././azureSubscriptions/#step-2-grant-access-to-cloudneeti-registered-app">Grant access to Azure subscription</a></td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
<td>mandatory</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td><a href="../../onboardingGuide/grantAccessToAzureSubscriptionAdditionalRoles/" target="_blank">Grant access to Azure subscription additional roles</a></td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
<td>optional</td>
<td>12</td>
</tr>
<tr>
<td>4</td>
<td><a href="../../onboardingGuide/grantAccessToKeyVaults/" target="_blank">Grant access to key vaults</a></td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
<td>optional</td>
<td>1</td>
</tr>
<tr>
<td>5</td>
<td><a href="../../onboardingGuide/azureAdvancedSecurityConfigurations/" target="_blank">Advanced Security configuration</a></td>
<td>Microsoft Azure</td>
<td>Subscription Owner, Global AD Reader</td>
<td>optional</td>
<td>18</td>
</tr>
<tr>
<td>6</td>
<td><a href="../../onboardingGuide/enableASCAuditPolicies/" target="_blank">Enable Azure Security Center audit policies</a></td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
<td>optional</td>
<td>115</td>
</tr>
<tr>
<td>7</td>
<td><a href="../../onboardingGuide/azureVulnerability/" target="_blank">Configure OS baseline and Vulnerability Assessment Solution</a></td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
<td>optional</td>
<td>513</td>
</tr>
<tr>
<td>8</td>
<td><a href="../../onboardingGuide/configureCloudneetiAgentInAKS/" target="_blank">Configure Cloudneeti agent on AKS, AKS Engine and VM Based Kubernetes Clusters</a></td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
<td>optional</td>
<td>73</td>
</tr>
<tr>
<td>9</td>
<td><a href="../../onboardingGuide/azureSubscriptions/#step-9-add-azure-subscription" target="_blank">Add Azure subscription</a></td>
<td>Cloudneeti</td>
<td>License Admin</td>
<td>mandatory</td>
<td>0</td>
</tr>
</tbody>
</table>
<h3 id="required-roles">Required Roles</h3>
<p>One or more people with the following roles are required to complete Microsoft
Azure onboarding process.</p>
<table>
<thead>
<tr>
<th><strong>Pre-requisite Role</strong></th>
<th><strong>Portal to use</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>License Admin</td>
<td>Cloudneeti application</td>
</tr>
<tr>
<td>Global AD Administrator</td>
<td>Microsoft Azure</td>
</tr>
<tr>
<td>Subscription Owner</td>
<td>Microsoft Azure</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>Onboarding a cloud account (in this case an Azure Subscription) requires the
    logged in user to be assigned the <strong>License Admin</strong> role in the Cloudneeti
    application.</p>
</li>
<li>
<p>Microsoft Azure <strong>Global AD Administrator</strong> role is required for App
    Registration of the Cloudneeti application and granting access rights to the
    Cloudneeti application.</p>
</li>
<li>
<p>The Microsoft Azure <strong>Subscription Owner</strong> role is required for providing
    Cloudneeti application required read access to the Azure Subscription.</p>
</li>
</ul>
<h3 id="required-permissions">Required Permissions</h3>
<p>Cloudneeti application will be granted five read permissions to Azure AD and
Azure subscriptions. Four of these permissions are optional. Each optional read
permission is linked to a number of security policies where this permission is
needed for data collection. If an optional permission will not be provided,
Cloudneeti application will not be able to collect the data for the related
policies. Excluded security policies by permission are listed later in this
document.</p>
<table>
<thead>
<tr>
<th>Object</th>
<th>Role / Permission</th>
<th>Portal to use</th>
<th>Required Role</th>
<th>Step</th>
<th>Type</th>
<th>Policies</th>
</tr>
</thead>
<tbody>
<tr>
<td>Azure Active Directory</td>
<td>Directory Read All Microsoft Graph</td>
<td>Microsoft Azure</td>
<td>Global AD Admin</td>
<td>STEP 1</td>
<td>optional</td>
<td>5</td>
</tr>
<tr>
<td>Azure Subscription</td>
<td>Reader</td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
<td>STEP 2</td>
<td>mandatory</td>
<td>0</td>
</tr>
<tr>
<td>Azure Subscription</td>
<td>Custom role</td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
<td>STEP 3</td>
<td>optional</td>
<td>11</td>
</tr>
<tr>
<td>Azure Subscription</td>
<td>Custom role</td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
<td>STEP 3</td>
<td>optional</td>
<td>1</td>
</tr>
<tr>
<td>Key Vault</td>
<td>Access Policy</td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
<td>STEP 4</td>
<td>optional</td>
<td>1</td>
</tr>
</tbody>
</table>
<h2 id="step-1-create-new-azure-app-registration-manually-or-using-azure-powershell-script">STEP 1: Create new Azure App Registration Manually or using Azure powershell script</h2>
<p>The following steps are executed by the Microsoft Azure <strong>Global AD
Administrator</strong> role on the Microsoft Azure Portal.</p>
<p>The Cloudneeti application can be registered either manually or using automation
script.</p>
<h3 id="11-manual-steps">1.1 Manual Steps</h3>
<p>Following manual steps allow you to understand the actual steps and permissions needed to create the Azure Application. If you prefer to automate this steps, please refer to 1.1 (Automated) section</p>
<h4 id="create-new-azure-app-registration">Create new Azure App Registration</h4>
<p>Login to <a href="https://portal.azure.com/" target="_blank">Azure Portal</a> with <strong>Global AD Administrator</strong> role.</p>
<ol>
<li>
<p>Select <strong>Azure Active Directory</strong> in the primary menu</p>
</li>
<li>
<p>Select <strong>App Registrations</strong> in the secondary menu</p>
</li>
<li>
<p>Click on <strong>New Registration</strong></p>
<p><img alt="Service Principal - Azure Portal" src="../../images/azureSubscriptions/AzureManual_AddSP.png" /></p>
</li>
<li>
<p>Enter the name, for example "Cloudneeti"</p>
</li>
<li>
<p>Click <strong>Register</strong>     </p>
<p><img alt="Service Principal - Azure Portal" src="../../images/azureSubscriptions/AzureManual_Register.png#thumbnail" /></p>
</li>
<li>
<p><strong>Copy to clipboard</strong> and paste the Application id to your notepad</p>
<p><img alt="Service Principal - Azure Portal" src="../../images/azureSubscriptions/Azure_AppReg_App_ID.png#thumbnail" /></p>
</li>
</ol>
<h4 id="add-client-secret">Add Client Secret</h4>
<ol>
<li>Click on <strong>new client secret</strong> in <strong>Certificates &amp; secrets</strong> section</li>
<li>Add <strong>Description</strong> and select expiry time </li>
<li>Click on <strong>Add</strong> </li>
<li>
<p><strong>Copy</strong> to clipboard and paste the Client Secret to your notepad. <strong>Note:</strong> You will not be able to copy this value after you move away from this screen.</p>
<p><img alt="Client Secret" src="../../images/azureSubscriptions/AzureSP_CaptureClientSecret.png#thumbnail" /></p>
</li>
</ol>
<h4 id="grant-admin-consent-for-api-permissions">Grant admin consent for API permissions</h4>
<p><strong>This step is optional</strong></p>
<p>Add Read All Microsoft Graph permissions and grant admin consent</p>
<p>This step is needed to gain access to Azure AD related policies. If the customer
doesn’t want to grant Cloudneeti application access to customer’s Azure AD, this
step can be skipped. The Cloudneeti application will not be able to provide
Azure AD related security policy information.</p>
<ol>
<li>Click <strong>API Permissions</strong></li>
<li>
<p>Click <strong>Add permission</strong> and add the following information:</p>
<table>
<thead>
<tr>
<th>API</th>
<th>Permission Name</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft.Graph</td>
<td>Directory.Read.All <a href="https://docs.microsoft.com/en-us/graph/permissions-reference#directory-permissions" target="_blank">Refer here</a></td>
<td>Application</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click on <strong>Grant admin consent for …</strong> button in the Grant consent section. </p>
<p><img alt="Service Principal - Azure Portal" src="../../images/azureSubscriptions/Azure_API_Permissions.png#thumbnail" /></p>
</li>
</ol>
<h3 id="11-automated-steps">1.1 Automated Steps</h3>
<p>Automated steps allow you to apply repeatability and consistency in provisioning. These steps replace 1.1 (Manual) section above.</p>
<h4 id="create-new-azure-app-registration_1">Create new Azure App Registration</h4>
<h5 id="prerequisites">Prerequisites</h5>
<p>The below steps are required for registering Cloudneeti application in Azure Tenant using PowerShell script.</p>
<table>
<thead>
<tr>
<th>Activity</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.    Download and review <strong>PowerShell script</strong> for creation of the service principal</td>
<td>The PowerShell script is used to create a service principal in Azure Tenant AD: <a href="https://github.com/Cloudneeti/docs_cloudneeti/blob/master/scripts/Create-ServicePrincipal-AzureOnboarding.ps1" target="_blank">Download Link.</a></td>
</tr>
<tr>
<td>2.    <strong>Workstation</strong>: Ensure you have the latest PowerShell version (v5 and above)</td>
<td>Verify PowerShell version by running the following command<br><code>$PSVersionTable.PSVersion</code><br>on the workstation where you will run the ServicePrincipal creation script. If PowerShell version is lower than 5, then follow this link for installation of a later version: <a href="https://docs.microsoft.com/en-us/powershell/scripting/install/installing-windows-powershell?view=powershell-6" target="_blank">Download Link.</a></td>
</tr>
<tr>
<td>3.    <strong>Workstation:</strong> Before executing the script, make sure there are no restrictions in running the PowerShell script</td>
<td>Use this PowerShell command:<br><code>Set-ExecutionPolicy `</code><br><code>-Scope Process `</code><br><code>-ExecutionPolicy Bypass</code><br>PowerShell contains built-in execution policies that limit its use as an attack vector. By default, the execution policy is set to Restricted, which is the primary policy for script execution. The bypass allows for running scripts and keeps the lowered permissions isolated to just the current running process.</td>
</tr>
<tr>
<td>4.    <strong>Workstation:</strong> Install Azure Modules to execute PowerShell commands within service principal automation script</td>
<td><code>Install-Module `</code><br><code>-Name AzureAD `</code><br><code>-MinimumVersion 2.0.0.131</code><br><br>It is a roll-up module for the Azure Resource Manager cmdlets.</td>
</tr>
</tbody>
</table>
<h5 id="register-cloudneeti-application">Register Cloudneeti Application</h5>
<p>Use the Create-ServicePrincipal-AzureOnboarding.ps1 script to create and register a Cloudneeti Application.</p>
<ol>
<li>Open PowerShell in administrator mode.</li>
<li>Go to the directory where Create-ServicePrincipal-AzureOnboarding.ps1 was downloaded earlier.</li>
<li>
<p>Run the below command to create a service principal
    <pre>
    <code><code>.\Create-ServicePrincipal-AzureOnboarding.ps1 `
        -azureActiveDirectoryId &lt;Active_Directory_Id&gt; `
        -servicePrincipalName &lt;data_collector_name&gt; `
        -expirationPeriod 1year</code></code>
    </pre></p>
</li>
<li>
<p>The script will prompt the login screen</p>
</li>
<li>Log in with Global AD Administrator or Application Administrator user credentials.</li>
<li>
<p>Store service principal information from the output in a notepad. This information will be needed while onboarding the Azure account in the Cloudneeti portal.</p>
<p><img alt="Service Principal Screenshot" src="../../images/azureSubscriptions/Azure_SP_Creatoin.png#thumbnail" /></p>
</li>
</ol>
<p><strong>Note:</strong><br>In case the user doesn’t want to provide the Microsoft Graph permissions given in section Azure Active Directory Permissions, you can use the disableADPolicies switch in the Create-ServicePrincipal-AzureOnboarding.ps1 command:
    <pre>
    <code><code>.\Create-ServicePrincipal-AzureOnboarding.ps1 `
        -azureActiveDirectoryId &lt;Active_Directory_Id&gt; `
        -servicePrincipalName &lt;data_collector_name&gt; `
        -expirationPeriod 1year `
        -disableADPolicies</code></code>
    </pre></p>
<h5 id="grant-admin-consent-for-api-permissions_1">Grant admin consent for API permissions</h5>
<p><strong>This step is optional</strong></p>
<ol>
<li>Login to <a href="https://portal.azure.com/" target="_blank">Azure Portal</a> with <strong>Global AD Administrator role</strong>.</li>
<li>Click on <strong>Azure Active Directory</strong> </li>
<li>Select <strong>App registrations</strong></li>
<li>
<p>Select Cloudneeti Application</p>
<p><img alt="Service Principal - Azure Portal" src="../../images/azureSubscriptions/Grant_Permission.png#thumbnail" /></p>
</li>
<li>
<p>Go to <strong>API permissions</strong> (1)</p>
</li>
<li>Click <strong>Add a permission</strong> (2)</li>
<li>Click on the <strong>Grant admin consent for…</strong> (3) in the Grant consent section.</li>
<li>
<p>A notification is displayed (4) “Successfully granted admin consent for the requested permissions”</p>
<p><img alt="Grant permission " src="../../images/azureSubscriptions/Azure_API_Permissions.png#thumbnail" /></p>
</li>
</ol>
<h2 id="step-2-grant-access-to-cloudneeti-registered-app-existing">STEP 2: Grant access to Cloudneeti registered app existing</h2>
<p>Reader role need to be granted to the Cloudneeti App registered in the previous step</p>
<p>The following steps are done by Microsoft Azure <strong>Subscription Owner</strong> role.</p>
<h3 id="21-grant-azure-subscription-reader-role">2.1 Grant Azure Subscription Reader role</h3>
<p><strong>This step is mandatory</strong></p>
<p>Add reader role for Cloudneeti application in Azure Subscription.</p>
<p>Login to <a href="https://portal.azure.com/" target="_blank">Azure Portal</a> with Microsoft Azure <strong>Subscription Owner</strong> role.</p>
<ol>
<li>Go to the subscription’s <strong>Access control (IAM)</strong> in the third level menu</li>
<li>Click on the <strong>Add</strong> button and select <strong>Add role assignment</strong></li>
<li>Select <strong>Reader</strong> role and Cloudneeti</li>
<li>
<p>Select <strong>Save</strong> to complete the role assignment</p>
<p><img alt="Assign role" src="../../images/azureSubscriptions/Azure_Assign_Role.png#thumbnail" /></p>
</li>
</ol>
<h3 id="23-collect-information">2.3 Collect information</h3>
<p>The Cloudneeti application <strong>License Admin</strong> requires this information to add an Azure subscription as a cloud account.</p>
<table>
<thead>
<tr>
<th>Information</th>
<th>Portal to use</th>
<th>User</th>
</tr>
</thead>
<tbody>
<tr>
<td>Azure Directory ID</td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
</tr>
<tr>
<td>Azure Active Directory Domain name</td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
</tr>
<tr>
<td>Registered Cloudneeti Application ID</td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
</tr>
<tr>
<td>Registered Cloudneeti Application Secret</td>
<td>Microsoft Azure</td>
<td>Subscription Owner</td>
</tr>
</tbody>
</table>
<h4 id="azure-directory-id-and-domain-name">Azure Directory Id and Domain Name</h4>
<ol>
<li>
<p>Navigate to <strong>Azure Active Directory</strong> (1)</p>
</li>
<li>
<p>Copy <strong>Domain Name</strong> (2) to a notepad</p>
</li>
<li>
<p>Copy <strong>Directory ID</strong> (3) to a notepad</p>
<p><img alt="Azure Directory" src="../../images/azureSubscriptions/Azure_Directory_ID.png#thumbnail" /></p>
</li>
</ol>
<h4 id="registered-cloudneeti-application-id">Registered Cloudneeti Application ID</h4>
<ol>
<li>
<p>Select <strong>Azure Active Directory</strong> in the primary menu</p>
</li>
<li>
<p>Select <strong>App Registrations</strong> in the secondary menu</p>
</li>
<li>
<p>Select Cloudneeti Application registered in <a href=".././azureSubscriptions/#step-1-create-new-azure-app-registration-manually-or-using-azure-powershell-script">step 1</a></p>
<p><img alt="Azure Domain" src="../../images/azureSubscriptions/Grant_Permission.png#thumbnail" /></p>
</li>
<li>
<p>Copy the Cloudneeti Application id
    <img alt="Azure Domain" src="../../images/azureSubscriptions/Azure_AppReg_App_ID.png#thumbnail" /></p>
</li>
</ol>
<h4 id="registered-cloudneeti-application-secret">Registered Cloudneeti Application Secret</h4>
<ol>
<li>
<p>Select <strong>Azure Active Directory</strong> in the primary menu</p>
</li>
<li>
<p>Select <strong>App Registrations</strong> in the secondary menu</p>
</li>
<li>
<p>Select Cloudneeti Application registered in <a href=".././azureSubscriptions/#step-1-register-cloudneeti-application-manually-or-using-azure-powershell-script">step 1</a></p>
</li>
<li>
<p>Click on <strong>new client secret</strong> in <strong>Certificates &amp; secrets</strong> section</p>
</li>
<li>
<p>Add <strong>Description</strong> and select expiry time</p>
</li>
<li>
<p>Click on <strong>Add</strong></p>
</li>
<li>
<p><strong>Copy to clipboard</strong> and paste the Client Secret to your notepad. <strong>Note:</strong>
    You will not be able to copy this value after you move away from this
    screen.
    <img alt="Application Secret" src="../../images/azureSubscriptions/AzureSP_CaptureClientSecret.png#thumbnail" /></p>
</li>
</ol>
<h2 id="step-3-grant-access-to-azure-subscription-additional-roles">STEP 3: Grant access to Azure subscription additional roles</h2>
<p><strong>This step is optional</strong></p>
<p><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/custom-roles">Azure custom role</a> needs to be granted to the Cloudneeti App registered in the previous step with following permission.</p>
<p>Custom role with permission <strong>"Microsoft.Web/sites/config/list/action"</strong> for Azure Subscription level scope.</p>
<ul>
<li>
<p>The Cloudneeti application needs "Microsoft.Web/sites/config/list/action" action present in <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#custom-role-with-permission-microsoftwebsitesconfiglistaction">Website Contributor role</a> in order to collect authentication and authorization configuration of Web/API/Mobile/Function Apps which is hosted on the App Service Plan. The current subscription Reader role given doesn't have sufficient permissions to collect web site configuration details.</p>
</li>
<li>
<p>If the custom role with "Microsoft.Web/sites/config/list/action" is not assigned, Cloudneeti application will not be able to collect data of security policies <a href=".././grantAccessToAzureSubscriptionAdditionalRoles/#custom-role-with-permission-microsoftwebsitesconfiglistaction">listed here.</a></p>
</li>
</ul>
<p>Custom role with permission <strong>"Microsoft.Storage/storageAccounts/listkeys/action"</strong> for Azure Subscription level scope.</p>
<ul>
<li>
<p>Cloudneeti needs "Microsoft.Storage/storageAccounts/listkeys/action" action present in <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#storage">Storage Account Contributor role</a> in order to collect metadata configuration of blobs.  The current subscription <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#reader">Reader role</a> given doesn't have sufficient permissions to list blob keys. </p>
</li>
<li>
<p>If the custom role with "Microsoft.Storage/storageAccounts/listkeys/action" is not assigned, Cloudneeti application will not be able to collect data of security policies <a href=".././grantAccessToAzureSubscriptionAdditionalRoles/#custom-role-with-permission-microsoftstoragestorageaccountslistkeysaction">listed here.</a></p>
</li>
</ul>
<p>The following roles need to be granted to the Cloudneeti App registered in the previous step. Please follow <a href="../../onboardingGuide/grantAccessToAzureSubscriptionAdditionalRoles/" target="_blank">link</a> for steps.</p>
<h2 id="step-4-grant-access-to-key-vaults">STEP 4: Grant access to key vaults</h2>
<p><strong>This step is optional.</strong>
The Cloudneeti application requires special permission on desired key vaults to get policy data related to secrets. 
If the Key Vault access policy is not added, Cloudneeti application will not be able to collect data of security policies <a href=".././grantAccessToKeyVaults/#key-vault-list" target="_blank">listed here</a>.</p>
<p>Please follow <a href="../../onboardingGuide/grantAccessToKeyVaults/" target="_blank">link</a> for steps.</p>
<h2 id="step-5-advanced-security-configurations">STEP 5: Advanced Security configurations</h2>
<p><strong>This step is optional.</strong>
An Azure Automation Account resource is deployed to collect data for additional security policies listed here . The Azure Active Directory control plane exposes the data only through PowerShell that needs to run under a Global AD reader credential.</p>
<p>To ensure that Cloudneeti does not ever store/have access to a global AD reader, it is recommended to deploy a small PowerShell script under customer’s control in their own Azure subscription. The metadata collected after running a script is then pushed to a Cloudneeti API that you registered during the Cloudneeti API key generation.</p>
<p>Please follow <a href="../../onboardingGuide/azureAdvancedSecurityConfigurations/" target="_blank">link</a> for steps.</p>
<h2 id="step-6-enable-azure-security-center-audit-policies">STEP 6: Enable Azure Security Center audit policies</h2>
<p>Enable pull integration with Azure Security Center free tier using either manual steps or automated scripts. 
Automated scripts will update configurations to enable data collection for the policies <a href="../../onboardingGuide/enableASCAuditPolicies/#asc-policy-list" target="_blank">listed here</a>.</p>
<p>Note : Please note that it is not required to have Azure Defender enabled (ASC Standard tier).</p>
<p>Please follow <a href="../../onboardingGuide/enableASCAuditPolicies/" target="_blank">link</a> for steps.</p>
<h2 id="step-7-configure-os-baseline-and-vulnerability-assessment-solution">STEP 7: Configure OS baseline and Vulnerability Assessment Solution</h2>
<p><strong>This step is optional.</strong> 
Enabling Auto Provisioning of Azure Security Center monitoring agent and connect VMs to OMS workspace allows various OS baselines as defined by CIS automatically light up on the Cloudneeti dashboards.</p>
<p>Deploy partner Vulnerability Assessment Solution in Azure Security Center and installing the solution on multiple VMs allows to provide visibility into protection status and threat protection.</p>
<p>Please follow <a href="../../onboardingGuide/azureVulnerability/" target="_blank">link</a> for steps.</p>
<h2 id="step-8-configure-cloudneeti-agent-on-aks-aks-engine-and-vm-based-kubernetes-clusters">STEP 8: Configure Cloudneeti agent on AKS, AKS Engine and VM based Kubernetes Clusters</h2>
<p><strong>This step is optional.</strong> </p>
<p>Cloudneeti includes and extends Azure Security center recommendations for AKS by deploying a Cloudneeti agent to Azure Kubernetes Cluster. A docker container agent is deployed to collect data for additional security policies. Cloudneeti then provides out-of-box mappings for all 13+ compliance frameworks included in the product. </p>
<p>Please follow <a href="../../onboardingGuide/configureCloudneetiAgentInAKS/" target="_blank">link</a> for steps.</p>
<h2 id="step-9-add-azure-subscription">STEP 9: Add Azure Subscription</h2>
<p>The following steps are done by Cloudneeti application <strong>License Admin</strong> role.</p>
<h3 id="91-activate-the-license">9.1 Activate the License</h3>
<ol>
<li>Log in to the Cloudneeti application with <strong>License Admin</strong> role.</li>
<li>Click on <strong>Activate License</strong>
    <img alt="Activate License" src="../../images/azureSubscriptions/Activate_License.png#thumbnail" /></li>
</ol>
<h3 id="92-add-cloud-account">9.2 Add Cloud Account</h3>
<ol>
<li>Select cloud connector for <strong>Microsoft Azure</strong>
    <img alt="Add Account" src="../../images/azureSubscriptions/Azure_Select_Connector_Type.png#thumbnail" /></li>
<li>Fill in the Account Name, Domain name, Azure Tenant Id (Domain ID) Azure
    Application ID and Azure Application Password.
    <img alt="Add Account" src="../../images/azureSubscriptions/Azure_Create_Account.png#thumbnail" /></li>
<li>Click on <strong>Get Subscriptions</strong> to get the list of Azure subscriptions that
    Cloudneeti application can access in the selected azure tenant. If your
    subscription does not exist on the list then please check access to service
    principal</li>
<li><strong>Select Subscription</strong> in the dropdown menu</li>
<li>Click <strong>Save &amp; Continue</strong>
    <img alt="Add Account" src="../../images/azureSubscriptions/Add_Azure_Account_Select_Subscription.png#thumbnail" /></li>
<li>You will receive a confirmation that the Azure subscription has been added.
    <img alt="Add Account" src="../../images/azureSubscriptions/Account_Success.png#thumbnail" /></li>
</ol>
<h3 id="93-data-collection-and-verfication">9.3 Data Collection and verfication</h3>
<p>Once the Azure subscription is added to the cloud account under Cloudneeti
License, it requires about 5 minutes for the data to be collected and processed,
before they can be displayed in Cloudneeti dashboards.</p>
<ol>
<li>
<p>Select <strong>Dashboard</strong> on the menu</p>
</li>
<li>
<p>Review the data on dashboard
    <img alt="Data Collection" src="../../images/azureSubscriptions/Dashboard.png#thumbnail" /></p>
<p>Congratulations! You have added an Azure subscription to Cloudneeti application.</p>
</li>
<li>
<p>Verify <a href="../../onboardingGuide/azureAccountHealthStatus/">cloud account health status</a> for prerequisite permissions and configurations verfied on every scan.   </p>
</li>
</ol>
<p><strong>Note:</strong>
Cloudneeti uses the App Registration (aka service principal) to register Cloudneeti’s MPN ID (4758633) as a Partner to your Azure subscription. It usually takes about a month for Microsoft to reflect this association on the <a href="https://portal.azure.com/#blade/Microsoft_Azure_Billing/managementpartnerblade" target="_blank">Customer's Partner Admin Link (PAL) portal page</a>.</p>
<p>Microsoft’s PAL program makes it easier for Cloudneeti to be recognized as a cloud partner to the customer. This allows Microsoft to share information to Cloudneeti on the health of Azure Subscription (Active/Disabled) and Account Management Support (Technical/Billing) as and when requested by Customer.
For more information, refer to the documentation link here <a href="https://docs.microsoft.com/en-us/azure/billing/billing-partner-admin-link-started" target="_blank">Link a Partner ID to your Azure accounts</a>.</p>
<h2 id="next-steps">Next Steps</h2>
<h3 id="onboard-another-microsoft-azure-subscription-to-the-cloudneeti-application">Onboard another Microsoft Azure Subscription to the Cloudneeti application</h3>
<p>Please follow <a href="../../onboardingGuide/azureSubscriptions/#step-1-create-new-azure-app-registration-manually-or-using-azure-powershell-script">STEP 1</a> to <a href="../../onboardingGuide/azureSubscriptions/#step-8-configure-cloudneeti-agent-on-aks">STEP 8</a> for required prerequisites configurations. Then add Azure subscription to Cloudneeti Application using below steps:</p>
<h4 id="1-azure-subscription-is-in-same-azure-active-directory-as-of-already-added-cloud-accounts">1. Azure subscription is in same Azure Active Directory as of already added Cloud accounts.</h4>
<ol>
<li>
<p>Navigate to <strong>Cloud Accounts</strong> (2) page in <strong>Configutrations</strong> (1)</p>
</li>
<li>
<p>Click <strong>Add Cloud Account</strong> (3)</p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_1.png#thumbnail" /></p>
</li>
<li>
<p>Select <strong>License</strong> to add a Cloud account </p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_2.png#thumbnail" /></p>
</li>
<li>
<p>Select cloud connector as <strong>Azure</strong></p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_3.png#thumbnail" /></p>
</li>
<li>
<p><strong>Select existing Tenant</strong></p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_4a.png#thumbnail" /></p>
</li>
<li>
<p>Fill in the <strong>Account Name</strong></p>
</li>
<li>
<p>Click <strong>Get Subscription</strong></p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_4b.png#thumbnail" /></p>
</li>
<li>
<p>This will list subscriptions in the selected azure tenant. If your subscription does not exist in list then please check access to Cloudneeti Application is as stated in<a href="../../onboardingGuide/azureSubscriptions/#step-2-grant-access-to-cloudneeti-registered-app-existing">prerequisite step 2</a> </p>
</li>
<li>
<p>Select <strong>subscription</strong> to onboard new cloud account.</p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_4c.png#thumbnail" /></p>
</li>
<li>
<p><strong>Save</strong></p>
</li>
<li>
<p>You will receive a confirmation that the Azure subscription has been added.
    <img alt="Add Account" src="../../images/azureSubscriptions/Account_Success.png#thumbnail" /></p>
</li>
</ol>
<h4 id="2-azure-subscription-is-in-different-azure-active-directory-as-of-already-added-cloud-accounts">2. Azure subscription is in different Azure Active Directory as of already added Cloud accounts.</h4>
<ol>
<li>
<p>Navigate to <strong>Cloud Accounts</strong> (2) page in <strong>Configutrations</strong> (1)</p>
</li>
<li>
<p>Click <strong>Add Cloud Account</strong> (3)</p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_1.png#thumbnail" /></p>
</li>
<li>
<p>Select <strong>License</strong> to add a Cloud account </p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_2.png#thumbnail" /></p>
</li>
<li>
<p>Select cloud connector as <strong>Azure</strong></p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_3.png#thumbnail" /></p>
</li>
<li>
<p>Keep <strong>Select existing Tenant</strong> blank</p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_4a.png#thumbnail" /></p>
</li>
<li>
<p>Fill in the 
    <strong>Account Name</strong>
    <strong>Domain name</strong>
    <strong>Azure Tenant Id (Domain ID)</strong>, 
    <strong>Azure Application ID</strong> 
    and <strong>Azure Application Password</strong></p>
</li>
<li>
<p>Click <strong>Get Subscription</strong></p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_5.png#thumbnail" /></p>
</li>
<li>
<p>This will list subscriptions in the selected azure tenant. If your subscription does not exist in list then please check access to Cloudneeti Application is as stated in<a href="../../onboardingGuide/azureSubscriptions/#step-2-grant-access-to-cloudneeti-registered-app-existing">prerequisite step 2</a> </p>
</li>
<li>
<p>Select <strong>subscription</strong> to onboard new cloud account.</p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_6.png#thumbnail" /></p>
</li>
<li>
<p><strong>Add Account</strong></p>
<p><img alt="Add another account" src="../../images/azureSubscriptions/another_7.png#thumbnail" /></p>
</li>
<li>
<p>You will receive a confirmation that the Azure subscription has been added.</p>
<p><img alt="Add Account" src="../../images/azureSubscriptions/Account_Success.png#thumbnail" /></p>
</li>
</ol>
<h2 id="security-polices-with-required-roles-permissions">Security Polices with required roles, permissions</h2>
<p>The following Security Policies will be excluded if one or multiple roles are
not assigned.</p>
<table>
<thead>
<tr>
<th>Permissions</th>
<th>Number of Excluded Security Policies</th>
</tr>
</thead>
<tbody>
<tr>
<td>Read All Microsoft Graph permissions</td>
<td>5</td>
</tr>
<tr>
<td>Reader role for Azure Subscription level scope.</td>
<td>0</td>
</tr>
<tr>
<td>Custom role with permission 'Microsoft.Web/sites/config/list/action'</td>
<td>11</td>
</tr>
<tr>
<td>Custom role with permission 'Microsoft.Storage/storageAccounts/listkeys/action'</td>
<td>1</td>
</tr>
<tr>
<td>Key Vault access policies for specific managed Key Vaults</td>
<td>1</td>
</tr>
</tbody>
</table>
<h3 id="microsoft-graph">Microsoft Graph</h3>
<p>Microsoft graph permissions are needed to collect data for Azure AD related
security policies listed below.</p>
<table>
<thead>
<tr>
<th>Policy Title</th>
<th>AAD Entity Used for Evaluating Misconfiguration</th>
<th>Data Stored in Cloudneeti Data Store</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ensure that AD Application keys are rotated before they expires</td>
<td><em>passwordCredentials</em><br><br>Metadata information contained within the data entity will be key start-date, end-date, and expiry policies. No actual values are retrievable.</td>
<td><ul><li>AD Application Name</li><li>AD Application ID</li><li>Expiry Date</li></ul></td>
</tr>
<tr>
<td>Ensure that Service Principal Certificate are renewed before it expires</td>
<td><em>keyCredentials</em><br><br>Metadata information contained within the data involves start-date and end-date. Refer to documentation <a href="https://docs.microsoft.com/en-us/powershell/module/azuread/new-azureadserviceprincipalkeycredential?view=azureadps-2.0" target="_blank">here</a>.</td>
<td><ul><li>AD Application Name</li><li>AD Application ID</li><li>Expiry Date</li></ul></td>
</tr>
<tr>
<td>Ensure that there are no guest users</td>
<td><em>userType</em><br><br>Member or guest.</td>
<td><ul><li>No data is stored in the Cloudneeti database. This policy only retrieves the count of total users and how many are guest users.</li></ul></td>
</tr>
<tr>
<td>Enforce the policy to set Password to ‘always' expire in Azure Active Directory for all Organization Users</td>
<td><em>passwordPolicies</em><br><br>Metadata involving the length of the password, password strength, and password restrictions. Refer to documentation <a href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-sspr-policy#password-policies-that-only-apply-to-cloud-user-accounts" target="_blank">here</a>.</td>
<td><ul><li>No data is stored in the Cloudneeti database. This policy only retrieves the count of all organization users and how many of them have set ‘Password always expired’ to ‘On’.</li></ul></td>
</tr>
<tr>
<td>Ensure that Azure resources are accessible only through Organization Accoun</td>
<td><em>userType</em><br><br>Member or <a href="https://docs.microsoft.com/en-us/azure/active-directory/b2b/what-is-b2b" target="_blank">guest</a>.</td>
<td><ul><li>No data is stored in the Cloudneeti database. This policy only retrieves the count of external users in an organization who can access resources under the Azure Subscription.</ul></li></td>
</tr>
</tbody>
</table>
<!-- ## Configuration

[Configure Notifications](../../administratorGuide/configureNotifications/){target=_blank}
 -->

<h2 id="offboarding">OFFBOARDING</h2>
<h3 id="delete-app-registration-for-each-azure-subscription">Delete App Registration for each Azure Subscription</h3>
<p>Login to <a href="https://portal.azure.com/" target="_blank">Azure Portal</a> with <strong>Subscription Owner</strong>
role.</p>
<p>Cloudneeti application registration created during onboarding an Azure Subscription should be deleted which will remove permissions and assigned roles on subscription/subscriptions.</p>
<ol>
<li>
<p>Go to <strong>Azure Active Directory</strong></p>
</li>
<li>
<p>Click on <strong>App Registration</strong></p>
</li>
<li>
<p>Select <strong>Cloudneeti Application</strong> which has role assignment to Azure
    Subscription to be offboarded</p>
</li>
<li>
<p>Click on <strong>Delete</strong> to remove Cloudneeti Application registration
    <img alt="Azure Offboarding" src="../../images/azureSubscriptions/Azure_Offboarding.png#thumbnail" /></p>
</li>
</ol>
<h3 id="delete-cloud-account-in-cloudneeti-application">Delete cloud account in Cloudneeti application</h3>
<p>Please send a request to <a href="mailto:support@cloudneeti.com">support@cloudneeti.com</a> to delete this cloud account under your license.</p></article></div></div></main><footer class="md-footer"><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright"><div class="md-footer-copyright__highlight">&copy; 2020 Cloudneeti.All Rights Reserved. | <a href="https://www.cloudneeti.com/privacy-policy-2/" target="_blank"> Privacy Policy</a> | <a href="https://www.cloudneeti.com/terms-of-use/" target="_blank"> Terms of Use</a></div></div></div></div></footer>

</div><script src="../../assets/javascripts/application.d5a09f94.js"></script><script>app.initialize({version:"1.1.2",url:{base:"../.."}})</script><script src="../../javascripts/custom.js"></script></body></html>